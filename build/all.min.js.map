{"version":3,"sources":["app/app.js","app/components/header/header.controller.js","app/components/network/network.controller.js","app/services/UrlProvider.js","app/pages/home/home.controller.js","app/pages/species/species.controlller.js","assets/js/d3network.js","assets/js/metabolite.js","assets/js/pathway.js","assets/js/reaction.js"],"names":["angular","module","config","$stateProvider","$urlRouterProvider","otherwise","state","templateUrl","url","controller","$scope","title","$rootScope","$timeout","$state","$urlRouter","rippleColour","$http","$filter","UrlProvider","ngTableParams","divName","network","Network","height","$","width","sidebar","sidebarWidth","sidebarOffset","locked","deflated","species","getLockedClass","expandSidebar","deflateSidebar","tableParams","page","count","sorting","DOMAIN","total","length","getData","$defer","params","get","baseUrl","success","speciesData","orderedData","orderBy","resolve","slice","error","err","reject","dataRequest","data","addSpecie","alert","service","this","attributes","init","that","svg","d3","select","append","attr","keys","Object","i","specie","pathways","push","Pathway","changeDimensions","Metabolite","name","id","private","type","toString","console","log","getID","getJSON","selflink","links","selectAll","nodes","buildMetabolites","buildReactions","addForces","tick","metabolites","nodesJSON","tempLinks","reactions","Reaction","m","k","s","t","source","target","nodesMap","map","j","connections","ret","force","layout","charge","d","linkStrength","linkDistance","size","on","test"],"mappings":"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","file":"all.min.js","sourcesContent":["'use strict';\n\nangular.module('fbaApp', ['ui.router', 'lumx', 'ngTable'])\n\n.config(function($stateProvider, $urlRouterProvider) {\n    $urlRouterProvider.otherwise('/');\n\n    $stateProvider\n    .state('main', {\n        templateUrl: 'app/templates/main.html'\n    })\n    .state('main.home', {\n        url: '/',\n        templateUrl: 'app/pages/home/home.html',\n        controller: 'HomeCtrl'\n    })\n    .state('main.species', {\n        url: '/species',\n        templateUrl: 'app/pages/species/species.html',\n        controller: 'SpeciesCtrl'  \n    });\n})\n\n.controller('BodyCtrl', ['$scope', function($scope) {\n    $scope.title = 'iGEM UofT Computational Biology';\n}]);\n","'use strict';\n\nangular.module('fbaApp')\n\n.controller('HeaderCtrl', ['$rootScope', '$scope', '$timeout', '$state', '$urlRouter', \n        function($rootScope, $scope, $timeout, $state, $urlRouter) {\n    $scope.title = 'sdssd';\n\n    $scope.rippleColour = 'teal-500'; \n}]);\n","'use strict';\n\nangular.module('fbaApp')\n\n\n.controller('NetworkCtrl', ['$scope', '$http', '$filter', 'UrlProvider', 'ngTableParams',\n        function($scope, $http, $filter, UrlProvider, ngTableParams) {\n    var divName = '#network';\n\n\n\n    // ==== Network Class ====\n    var network = new Network(divName,  {\n                  height: $(divName).width(),\n                  width: $(divName).height(),\n                });\n\n    // ==== Sidebar ====\n    var sidebar = '#sidebar';\n    var sidebarWidth = $(sidebar).width();\n    var sidebarOffset = 100;\n    $scope.rippleColour = 'deep-purple-500';\n    $scope.locked = true;\n    $scope.deflated = true;\n    $scope.species = {};\n\n    $scope.getLockedClass = function() {\n        if ($scope.locked) {\n            return 'locked';\n        } else {\n            return 'unlocked';\n        }\n    }\n\n    /*$scope.lockControl = function() {\n        $scope.locked = !$scope.locked;\n\n        if (!$scope.locked) {\n           network.changeDimensions($('body').width(), $(network).height());\n        } else {\n          network.changeDimensions($('body').width() - sidebarWidth, $(network).height());\n        }\n    }*/\n  //  $scope.lockControl();\n\n    $scope.expandSidebar = function() {\n        $(sidebar).width($('body').width() - sidebarOffset);\n        $scope.deflated = false;\n    }\n\n    $scope.deflateSidebar = function() {\n        $(sidebar).width(sidebarWidth);\n        $scope.deflated = true;\n    }\n\n    $scope.tableParams = new ngTableParams({\n         page: 1,            // show first page\n         count: 10,          // count per page\n         sorting: {\n             DOMAIN: 'asc'     // initial sorting\n         }\n     }, {\n         total: $scope.species.length, // length of data\n         getData: function($defer, params) {\n            $http.get(UrlProvider.baseUrl + '/species/retrieve/all').success(function(speciesData){\n                $scope.species = speciesData;\n                var orderedData = params.sorting() ? $filter('orderBy')(speciesData, params.orderBy()) : speciesData;\n                params.total(speciesData.length);\n                $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n            }).error(function(err) {\n                $defer.reject(err);\n            })\n         }\n     });\n    // ==== End sidebar ====\n\n\n\n    // for now\n    var dataRequest = $http.get('http://45.55.193.224/toydata.json');\n    dataRequest.success(function(data) {\n          network.addSpecie(data.data[0]);\n    }).error(function(err) {\n        alert(err);\n    });\n}]);\n","'use strict';\n\nangular.module('fbaApp')\n\n.service('UrlProvider', function() {\n    this.baseUrl = 'http://localhost:9001';\n});\n","'use strict';\n\nangular.module('fbaApp')\n\n.controller('HomeCtrl', ['$scope', function($scope) {\n    $scope.title = 'iGEM UofT Computation Biology!';\n}]);\n","'use strict';\n\nangular.module('fbaApp')\n\n.controller('SpeciesCtrl', ['$scope', function($scope) {\n    $scope.title = 'species page';\n}]);\n","var Network = function(divName, attributes) {\n  // The instance\n  var that = this;\n  init(divName, attributes);\n\n  function init(divName, attributes){\n      that.svg = d3.select(divName).append('svg');\n      that.svg.attr(\"class\", \"body\");\n      that.attributes = attributes;\n      var keys = Object.keys(attributes);\n      for(var i = 0; i < keys.length; i++)\n        that.svg.attr(keys[i], attributes[keys[i]]);\n\n      that.network = that.svg.append(\"g\").attr(\"class\", \"network\");\n  }\n\n  function addSpecie(specie){\n    that.species = specie;\n    that.pathways = [];\n    that.pathways.push(new Pathway(that.network, specie));\n    //initalize pathways for the first time\n    //doit();\n    return that;\n  }\n\n  function changeDimensions(width, height) {\n    that.attributes.width = width;\n    that.attributes.height = height;\n    //  that.force\n    //.size([inst.traits.w, inst.traits.h]).start();\n  }\n  function doit(){\n\n    //Palette\n    var palette = {\n      \"red\": \"#FF0000\",\n      \"blue\": \"#3E87D1\",\n      \"green\": \"#33CC33\",\n      \"yellow\": \"#FFFF00\",\n      \"scarlet\": \"#990033\",\n      \"pink\": \"#FF99CC\",\n      \"purple\": \"#990099\",\n      \"black\": \"#000000\",\n      \"white\": \"#FFFFFF\",\n      \"gray\": \"#D2D2D2\",\n      \"brown\": \"#663300\",\n      \"orange\": \"#FF7519\",\n      \"darkblue\": \"#354458\",\n      \"skyblue\": \"#77c5f7\",\n      \"salmon\": \"#eb7260\",\n      \"aqua\": \"#eb7260\",\n      \"beige\": \"#e9e0d6\",\n      \"themedarkblue\" : \"#C4E4E6\",\n      \"themenodestroke\" :\"#3D8D8F\",\n      \"themelightblue\" : \"#BFE1BF\",\n      \"themeyellow\" : \"#FCD059\",\n      \"themewhite\" : \"#EDEDEA\",\n      \"linktest\" : \"#AED9AE\",\n      \"nodestroketest\" : \"#A2D7D8\", //#A2D7D8 vs #62BBBD\n      \"texttest\": \"#DE5842\"\n    };\n\n    var markers = [\n      {id: \"triangle\", path: 'M 0,0 m -5,-5 L 5,0 L -5,5 Z', viewbox: '-5 -5 10 10' }\n    ];\n\n    var zoom = d3.behavior.zoom()\n    .scaleExtent([0.2, 40])\n    .on(\"zoom\", zoom);\n\n    that.svg\n    .call(zoom)\n    .on(\"dblclick.zoom\", null)\n    .on(\"contextmenu\", function(d, i){d3.event.preventDefault();}) //prevents default right click pop-up\n    .on(\"mousedown\", function(d){\n      d3.select(\".popup\").remove();\n      contextMenuShowing = false;\n    });\n    //dont need yet....\n    that.svg.append(\"rect\")\n    .attr(\"width\", that.attributes.width)\n    .attr(\"height\", that.attributes.height)\n    .style(\"fill\",\"transparent\")\n    .style(\"pointer-events\", \"all\");\n\n\n    var network = that.svg.append(\"g\")\n    .attr(\"class\", \"network\");\n\n\n    var nodes = [];\n    //JSON array{src:endpoint}\n    var links = [];\n\n    function zoom() {\n      network.attr(\"transform\", \"translate(\" + d3.event.translate + \")scale(\" + d3.event.scale + \")\");\n    };\n\n    function dblclick(d) {\n      //Doubleclick to place forces on node\n      d3.select(this).classed(\"fixed\", d.fixed = false);\n      force.start();\n    };\n\n    function nodeMouseover(d){\n      d3.select(this).selectAll(\".node-circle\").transition()\n      .duration(100)\n      .attr(\"r\", function(d){if(d.type == \"m\"){return 14} else{return 6}})\n      .attr(\"stroke\", palette.nodestroketest)\n      .attr(\"stroke-opacity\", function(d){if(d.type == \"m\"){return 1} else{return 0}})\n      .attr(\"stroke-width\", function(d){if(d.type ==\"m\"){return 2} else{return 35}})\n      .attr(\"opacity\", 1);\n\n      d3.select(this).selectAll(\".node-text\").transition()\n      .duration(100)\n      .attr(\"x\", 0)\n      .attr(\"y\", function(d){if(d.type == 'm'){return -24;}else{return -10}})\n      .style(\"opacity\", 1)\n      .attr(\"font-size\",function(d){if(d.type == 'm'){return \"1.4em\";}else{return \"1.0em\"}})\n      .attr(\"text-anchor\", \"middle\");\n    };\n\n    function nodeMouseout(d){\n\n      d3.select(this).selectAll(\".node-circle\").transition()\n      .duration(function(d){if(d.type == 'm'){return 100;}else{return 800}})\n      .attr(\"r\", function(d){if(d.type == \"m\"){return 10} else{return 4}})\n      .attr(\"stroke\", palette.nodestroketest)\n      .attr(\"stroke-opacity\", function(d){if(d.type == \"m\"){return 1} else{return 0}})\n      .attr(\"stroke-width\", function(d){if(d.type ==\"m\"){return 1} else{return 35}})\n      .attr(\"opacity\", 1);\n\n      d3.select(this).selectAll(\".node-text\").transition()\n      .duration(function(d){if(d.type == 'm'){return 100;}else{return 800}})\n      .attr(\"x\", 0)\n      .attr(\"y\", function(d){if(d.type == 'm'){return -18;}else{return -5}})\n      .style(\"opacity\", function(d){if(d.type == 'm'){return 0.8;}else{return 0}})\n      .attr(\"font-size\", function(d){if(d.type == 'm'){return \"1.1em\";}else{return \"0em\"}})\n      .attr(\"text-anchor\", \"middle\");\n    }\n    var tick = function(){\n\n      node.attr(\"transform\", function(d) {\n        console.log(node);\n        return \"translate(\" + d.x + \",\" + d.y + \")\"; });\n        link.attr(\"x1\", function(d) { return d.source.x; })\n        .attr(\"y1\", function(d) { return d.source.y; })\n        .attr(\"x2\", function(d) { return d.target.x; })\n        .attr(\"y2\", function(d) { return d.target.y; });\n      };\n\n      var force = d3.layout.force()\n      .nodes(nodes)\n      .links(links)\n      .charge(function(d){if(d.type == \"m\"){return -1000}else{return -500}})\n      .linkStrength(2)\n      .linkDistance(50)\n      .size([that.attributes.width, that.attributes.height])\n      .on(\"tick\", tick)\n      .start();\n      var dragstart = function(d) {\n        //Drag to fix node's position\n        d3.event.sourceEvent.stopPropagation();\n        d3.select(this).classed(\"fixed\", d.fixed = true);\n      };\n\n      var drag = force.drag().on(\"dragstart\", dragstart);\n\n      var link = network.append(\"g\")\n      .attr(\"class\", \"links\")\n      .selectAll(\"link\");\n\n      var node = network.append(\"g\")\n      .attr(\"class\", \"nodes\")\n      .selectAll(\"node\");\n\n      var marker = network.append(\"g\")\n      .attr(\"class\", \"markers\")\n      .selectAll(\".marker\")\n      .data(markers)\n      .enter()\n      .append('svg:marker')\n      .attr('id', function(d){ return d.id})\n      .attr('markerHeight', 5)\n      .attr('markerWidth', 5)\n      .attr('markerUnits', 'strokeWidth')\n      .attr('orient', 'auto')\n      .attr('refX', 13)\n      .attr('refY', 0)\n      .attr('fill', palette.linktest)\n      .attr('opacity', 1)\n      .attr('viewBox', function(d){ return d.viewbox })\n      .append('svg:path')\n      .attr('d', function(d){ return d.path });\n\n      window.addEventListener(\"keydown\", function (event) {\n\n        switch (event.keyCode) {\n          case 77:\n          // Do something for \"down arrow\" key press.\n          keyresult= \"m\";\n          break;\n          case 82:\n          // Do something for \"up arrow\" key press.\n          keyresult= \"r\";\n          break;\n\n          default:\n\n          return;\n\n        }\n\n        // Consume the event for suppressing \"double action\".\n        event.preventDefault();\n        if (keyresult===\"m\"){\n          nodes.push({id:\"New\"+num.toString(), name:\"New\"+num.toString(), type:'m'});\n          num++;\n          draw();\n          force.start();\n\n        }\n        else if (keyresult===\"r\")\n        { nodes.push({id:\"New\"+num.toString(), name:\"New\"+num.toString(), type:'r'});\n        num++;\n        draw();\n      }\n\n      keyresult=\"\";\n\n\n    });\n\n//==========================================================================================================================================\n//Adding Nodes and Links====================================================================================================================\n    var check = [];\n    //TEMP!!!!!!!!\n    var data = that.data;\n    console.log(data);\n    var tempLinks = [];\n    //making metabolite nodes\n    for (var j=0; j<data.length;j++){\n      for (var i = 0; i<data[j].metabolites.length; i++){\n        nodes.push ({\n          id: data[j].metabolites[i].id,\n          name:data[j].metabolites[i].name,\n          selflink: false,\n          type: \"m\"\n        });\n        check.push(data[j].metabolites[i].id);\n\n      }\n    };\n    //making reaction nodes\n    //Reaction -> r Metabolite -> m\n    for (var j=0; j<data.length;j++){\n      for (var i = 0; i<data[j].reactions.length; i++){\n        if(check.indexOf(data[j].reactions[i].id != -1)){\n          nodes.push ({id: data[j].reactions[i].id, name:data[j].reactions[i].name, selflink: false, type: \"r\"});\n          check.push(data[j].reactions[i].id);\n        }\n\n        var m = Object.keys(data[j].reactions[i].metabolites);\n        for (var k = 0; k<m.length; k++){\n          if(data[j].reactions[i].metabolites[m[k]]>0){\n            var s = data[j].reactions[i].id;\n            var t = m[k];\n          }else{\n            var s = m[k];\n            var t = data[j].reactions[i].id;\n          }\n          tempLinks.push({id: s+\"-\"+t, source: s, target: t});\n        }\n      }\n    };\n\n    var nodesMap = map(nodes);\n\n    for (var j=0; j<tempLinks.length;j++){\n      var s = nodes[nodesMap[tempLinks[j].source]];\n      var t = nodes[nodesMap[tempLinks[j].target]];\n      links.push({id: s.id+\"-\"+t.id, source: s, target: t});\n    }\n\n    function map(nodes){\n      var ret = {};\n      for (var j=0; j<nodes.length;j++){\n        ret[nodes[j].id] = j;\n      }\n      return ret;\n    }\n\n    //=============DRAW ALL THIS SHIT YEEEEEEEEEEE=========//\n    draw();\n\n\n\n\n\n\n    //=========================================================================================================================================\n    //FUNCTIONS================================================================================================================================\n    //=========================================================================================================================================\n    function draw(){\n      d3.selectAll(\"[class=node-selflink]\").remove();\n      d3.selectAll(\"[class=node-text]\").remove();\n      d3.selectAll(\"[class=node-circle]\").remove();\n      //d3.selectAll(\"[class=node-m]\").remove();\n      //d3.selectAll(\"[class=node-r]\").remove();\n\n\n      link = link.data(force.links(), function(d){ return d.source.id + \"-\" + d.target.id; })\n      link.enter().insert(\"line\")\n      .attr(\"class\", \"link\")\n      .attr(\"id\", function(d){return \"id-\"+d.id})\n      .attr(\"stroke\", palette.linktest)\n      .attr(\"fill\", \"none\")\n      .attr(\"opacity\", 1)\n      .attr(\"stroke-width\", 2)\n      .attr(\"marker-end\", function(d){if(d.source.type == \"r\"){return \"url(#triangle)\"}})\n      .on(\"contextmenu\", linkRightClick)\n      .on(\"mousedown\", function(d){\n        d3.select(\".popup\").remove();\n        contextMenuShowing = false;\n      });\n\n      link.exit().remove();\n\n      node = node.data(force.nodes(), function(d) { return d.id;});\n\n      node.enter().append(\"g\")\n      .attr(\"class\", \"node\")\n      .attr(\"id\", function(d){return \"id-\"+d.id})\n      .on(\"mouseout\", nodeMouseout)\n      .on('mouseover', nodeMouseover)\n      .on(\"dblclick\", dblclick)\n      .on(\"contextmenu\", nodeRightClick)\n      .on(\"mousedown\", function(d){\n        d3.select(\".popup\").remove();\n        contextMenuShowing = false;\n      })\n      .call(drag);\n\n      //Create circle shape for node\n      node.append(\"circle\")\n      .attr(\"class\", \"node-circle\")\n      //.attr(\"class\", function(d){if(d.type == 'm'){return \"node-m\";}else{return \"node-r\"}})\n      .attr(\"r\", function(d){if(d.type == 'm'){return 10;}else{return 4}})\n      .attr(\"stroke\", palette.nodestroketest)\n      .attr(\"stroke-width\", function(d){if(d.type == 'm'){return 1;}else{return 35}})\n      .attr(\"stroke-opacity\", function(d){if(d.type == 'm'){return 1;}else{return \"0\"}} )\n      .style(\"opacity\", 1)\n      .attr(\"fill\", function(d){if(d.type ==\"m\"){return palette.themedarkblue}else{return palette.themeyellow}});\n\n      //Create text for node\n      node.append(\"text\")\n      .attr(\"class\", \"node-text\")\n      .text(function(d, i) { return d.name; })\n      .attr(\"x\", 0)\n      .attr(\"y\", function(d){if(d.type == 'm'){return -18;}else{return -5}})\n      .attr(\"font-family\",  \"Arial\")\n      .attr(\"fill\", palette.texttest)\n      .style(\"opacity\", function(d){if(d.type == 'm'){return 0.8;}else{return 0}})\n      .attr(\"font-size\", function(d){if(d.type == 'm'){return \"1.1em\";}else{return \"0em\"}})\n      .attr(\"text-anchor\", \"middle\");\n      node.exit().remove();\n      //WIP\n      function linkRightClick(d,i){\n        var copy=[];\n        if (contextMenuShowing) {\n          d3.event.preventDefault();\n          d3.select(\".popup\").remove();\n          contextMenuShowing = false;\n        }\n        else{\n          d3.event.preventDefault();\n          contextMenuShowing = true;\n          var pop = d3.select(\"body\");\n          var mousePosition = d3.mouse(pop.node());\n\n          var popup = pop.append(\"div\")\n          .attr(\"class\", \"popup\")\n          .style(\"left\", mousePosition[0] + \"px\")\n          .style(\"top\", mousePosition[1] + \"px\");\n          //RENAME BUTTON\n          popup.append(\"input\")\n          .attr(\"type\", \"button\")\n          .attr(\"value\", \"Rename\")\n          .on(\"click\", function(){\n            alert(\"Rename this\" + d.id)\n          });\n          //Delete BUTTON\n          popup.append(\"input\")\n          .attr(\"type\", \"button\")\n          .attr(\"value\", \"Delete\")\n          .on(\"click\", function(){\n            for (var i =0; i<nodes.length;i++){\n              if (d.id==nodes[i].id){\n                nodes.splice(i, i+1);\n                i=nodes.length+100;\n              }}\n              for (var i =0; i<links.length;i++){\n                if (d.id==links[i].id){\n                  links.splice(i, i+1);\n                  i=links.length+100;\n                }}\n                draw();\n              });\n\n            }\n          }\n          function nodeRightClick(d,i){\n            if (contextMenuShowing) {\n              d3.event.preventDefault();\n              d3.select(\".popup\").remove();\n              contextMenuShowing = false;\n            }\n            else if(d.type == \"m\"){\n              d3.event.preventDefault();\n              contextMenuShowing = true;\n              var pop = d3.select(\"body\");\n              var mousePosition = d3.mouse(pop.node());\n\n              var popup = pop.append(\"div\")\n              .attr(\"class\", \"popup\")\n              .style(\"left\", mousePosition[0] + \"px\")\n              .style(\"top\", mousePosition[1] + \"px\");\n              //RENAME BUTTON\n              popup.append(\"input\")\n              .attr(\"type\", \"button\")\n              .attr(\"value\", \"Rename\")\n              .on(\"click\", function(d){\n                prompt(\"Rename this metabobitch\")\n              });\n              //Delete BUTTON\n              popup.append(\"input\")\n              .attr(\"type\", \"button\")\n              .attr(\"value\", \"Delete\")\n              .on(\"click\", function(d){\n                alert(\"Delete function\")\n              });\n            }\n            else{\n              d3.event.preventDefault();\n              contextMenuShowing = true;\n              var pop = d3.select(\"body\");\n              var mousePosition = d3.mouse(pop.node());\n\n              var popup = pop.append(\"div\")\n              .attr(\"class\", \"popup\")\n              .style(\"left\", mousePosition[0] + \"px\")\n              .style(\"top\", mousePosition[1] + \"px\");\n              //RENAME BUTTON\n              popup.append(\"input\")\n              .attr(\"type\", \"button\")\n              .attr(\"value\", \"Rename\")\n              .on(\"click\", function(){\n                alert(\"Rename this\" + d.id)\n              });\n              //Delete BUTTON\n              popup.append(\"input\")\n              .attr(\"type\", \"button\")\n              .attr(\"value\", \"Delete\")\n              .on(\"click\", function(){\n\n                for (var i=0; i<nodes.length ; i++){\n                  if (d.id == nodes[i].id){\n                    for (var o=0; o<i; o++){\n                      copy.push(nodes[o]);\n                    }\n                    for (var u=i+1; u<nodes.length; u++){\n                      copy.push (nodes[u]);\n                    }\n                    nodes=copy;\n                    copy=[];\n                    i=nodes.length+200;\n                  }\n\n                }\n\n              });\n              //Starts force layout\n              force.start();\n            }\n\n\n\n\n          }\n        }\n      }\n      return {\n        addSpecie: function(specie){\n            addSpecie(specie);\n        },\n        changeDimensions: function(width, height) {\n            changeDimensions(width, height);\n        }\n      }\n    }\n","var Metabolite = function(network, name, id){\n  var private = {\n    network: network,\n    id: id,\n    name: name,\n    type: \"m\"\n  }\n  return{\n    toString: function(){\n      console.log(\"Metabolite: \" + private.name + \" id: \" + private.id + \"\\n\");\n    },\n    getID: function(){\n      return private.id;\n    },\n    getJSON: function(){\n      return{\n        name: private.name,\n        id: private.id,\n        type: private.type,\n        selflink: false\n      }\n    }\n  }\n}\n","var Pathway = function(network, specie){\n  var private = {\n    network: network,\n    reactions: [], //bio shit\n    metabolites: [],\n    connections: [],\n    nodesJSON: [],\n    links: null, //D3 shit\n    nodes: null,\n    force: null\n  }\n  //initalize Pathway\n  init(specie);\n  //init\n  function init(specie){\n    //links selected\n    private.links = private.network.append(\"g\")\n    .attr(\"class\", \"links\")\n    .selectAll(\"link\");\n    //nodes selected\n    private.nodes = private.network.append(\"g\")\n    .attr(\"class\", \"nodes\")\n    .selectAll(\"node\");\n    //Create metabolite objects\n    buildMetabolites(specie);\n    //Create reaction objects\n    buildReactions(specie);\n    //add forces\n    addForces();\n  }\n  function tick(){\n\n  }\n  function buildMetabolites(specie){\n    for (var i = 0; i<specie.metabolites.length; i++){\n      private.metabolites.push(new Metabolite(private.network, specie.metabolites[i].name,\n                                                specie.metabolites[i].id));\n      private.nodesJSON.push(private.metabolites[i].getJSON());\n    }\n  }\n  function buildReactions(specie){\n    //Reaction -> r Metabolite -> m\n    var tempLinks = [];\n    for (var i = 0; i<specie.reactions.length; i++){\n      private.reactions.push(new Reaction(private.network,  specie.reactions[i].name,\n                                          specie.reactions[i].id));\n      private.nodesJSON.push(private.reactions[i].getJSON());\n      var m = Object.keys(specie.reactions[i].metabolites);\n      for (var k = 0; k<m.length; k++){\n        if(specie.reactions[i].metabolites[m[k]]>0){\n          var s = specie.reactions[i].id;\n          var t = m[k];\n        }else{\n          var s = m[k];\n          var t = specie.reactions[i].id;\n        }\n        tempLinks.push({id: s+\"-\"+t, source: s, target: t});\n\n      }\n    }\n    var nodesMap = map(private.metabolites, private.reactions);\n\n    for (var j=0; j<tempLinks.length;j++){\n      var s = private.metabolites[nodesMap[tempLinks[j].source]] || private.reactions[nodesMap[tempLinks[j].source]];\n      var t =  private.metabolites[nodesMap[tempLinks[j].target]] || private.reactions[nodesMap[tempLinks[j].target]];\n      private.connections.push({id: s.getID()+\"-\"+t.getID(), source: s.getJSON(), target: t.getJSON()});\n    }\n\n  }\n  //utilities function\n  function map(metabolites, reactions){\n    var ret = {};\n    for (var j=0; j<metabolites.length;j++){\n      ret[metabolites[j].getID()] = j;\n      //private.nodes.push(metabolites[j]);\n    }\n    for(var j = 0; j < reactions.length; j++){\n      ret[reactions[j].getID()] = j\n      //private.nodes.push(reactions[j]);\n    }\n\n    return ret;\n  }\n  function addForces(){\n    private.force = d3.layout.force()\n    .nodes(private.nodesJSON)\n    .links(private.connections)\n    .charge(function(d){if(d.type == \"m\"){return -1000}else{return -500}})\n    .linkStrength(2)\n    .linkDistance(50)\n    .size([private.network.width, private.network.height])\n    .on(\"tick\", tick);\n  }\n\n  return{\n    init: function(data){\n      init(data)\n    },\n    test: function(){\n      alert(\"test\");\n    }\n  }\n}\n","var Reaction = function(network, name, id){\n  var private = {\n    network: network,\n    id: id,\n    name: name,\n    type: \"r\"\n  }\n return{\n   toString: function(){\n     console.log(\"Reaction: \" + private.name + \" id: \" + private.id + \"\\n\");\n   },\n   getID: function(){\n     return private.id;\n   },\n   getJSON: function(){\n     return{\n       name: private.name,\n       id: private.id,\n       type: private.type,\n       selflink: false\n     }\n   }\n }\n}\n"],"sourceRoot":"/source/"}